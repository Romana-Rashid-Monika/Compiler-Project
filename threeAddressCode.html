<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Mini Compiler — Three-Address Code</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <link href="https://cdn.jsdelivr.net/npm/daisyui@5" rel="stylesheet" type="text/css" />
<script src="https://cdn.jsdelivr.net/npm/@tailwindcss/browser@4"></script>
  <style>
    :root {
      color-scheme: light dark;
    }
    body {
      font-family: system-ui, Segoe UI, Roboto, Helvetica, Arial, sans-serif;
      margin: 0;
      padding: 2rem;
      line-height: 1.5;
      background: #0f172a;
      color: #e2e8f0;
    }
    h1 {
      font-size: 1.4rem;
      margin: 0 0 1rem;
    }
    .container {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 1rem;
    }
    .panel {
      background: #111827;
      border: 1px solid #1f2937;
      border-radius: 10px;
      padding: 1rem;
    }
    textarea, pre, code, input, button {
      font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", monospace;
    }
    textarea {
      width: 100%;
      min-height: 160px;
      resize: vertical;
      background: #0b1220;
      color: #e2e8f0;
      border: 1px solid #1f2937;
      border-radius: 8px;
      padding: 0.75rem;
    }
    .row {
      display: flex;
      gap: 0.75rem;
      align-items: center;
      margin-top: 0.75rem;
    }
    button {
      background: #2563eb;
      color: white;
      border: none;
      padding: 0.6rem 1rem;
      border-radius: 8px;
      cursor: pointer;
    }
    button.secondary {
      background: #374151;
    }
    button:disabled {
      opacity: 0.6;
      cursor: not-allowed;
    }
    pre {
      background: #0b1220;
      color: #93c5fd;
      border: 1px solid #1f2937;
      border-radius: 8px;
      padding: 0.75rem;
      overflow: auto;
      min-height: 160px;
    }
    .grid-2 {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 0.75rem;
    }
    .label {
      font-weight: 600;
      color: #cbd5e1;
      margin-bottom: 0.5rem;
    }
    .footer {
      margin-top: 1rem;
      font-size: 0.9rem;
      color: #94a3b8;
    }
    .error {
      color: #fca5a5;
      white-space: pre-wrap;
    }
  </style>
</head>
<body>




    <div><h1 class="text-3xl text-center">CODE<span class="text-teal-900 font-bold">SHARP</span></h1>
</div>
    

<ul class="grid grid-cols-3 gap-25  pt-10">
    
            <li class="bg-blue-800 text-white px-4 py-2 rounded cursor-pointer hover:bg-blue-700 text-xl"><a href="compiler.html">LL1 Parser</a></li>
            <li class="bg-blue-800 text-white px-4 py-2 rounded cursor-pointer hover:bg-blue-700 text-xl"><a href="Assembly.html">Three-address code</a></li>
            <li class="bg-blue-800 text-white px-4 py-2 rounded cursor-pointer hover:bg-blue-700 text-xl"><a href="threeAddressCode.html">Assembly-like instructions</a></li>
        </ul>



  <h1 class="pt-10">Mini Compiler — Three-Address Code (Assignments & Expressions)</h1>

  <div class="container">
    <div class="panel">
      <div class="label">Source code (end statements with semicolons):</div>
      <textarea id="source" placeholder="Example:
a = 5;
b = a + 3;
c = (b * 2) + a;">
a = 5;
b = a + 3;
c = (b * 2) + a;
      </textarea>
      <div class="row">
        <button id="compileBtn">Compile</button>
        <button id="resetBtn" class="secondary">Reset</button>
      </div>
      <div id="error" class="error"></div>
    </div>

    <div class="panel">
      <div class="grid-2">
        <div>
          <div class="label">Three-address code (TAC):</div>
          <pre id="tac"></pre>
        </div>
        <div>
          <div class="label">Symbol table:</div>
          <pre id="symtab"></pre>
        </div>
      </div>
    </div>
  </div>

  <script>
    // --- Tokenizer ---
    function tokenize(input) {
      const tokens = [];
      const re = /\s+|([A-Za-z_]\w*)|(\d+)|([+\-*/=();])/g;
      let m;
      while ((m = re.exec(input)) !== null) {
        if (m[0].trim() === "") continue;
        if (m[1]) tokens.push({ type: "id", value: m[1] });
        else if (m[2]) tokens.push({ type: "num", value: m[2] });
        else tokens.push({ type: m[3], value: m[3] });
      }
      tokens.push({ type: "EOF", value: "" });
      return tokens;
    }

    // --- Parser with TAC generation ---
    function compile(source) {
      const tokens = tokenize(source);
      let pos = 0;
      let tempCounter = 0;
      const tac = [];
      const symtab = new Map(); // name -> { lastTemp: string|null, lastValue: string|null }

      function peek() { return tokens[pos]; }
      function consume(expectedType) {
        const t = tokens[pos];
        if (t.type !== expectedType) {
          throw new Error(`Expected '${expectedType}', found '${t.type}' at token #${pos}`);
        }
        pos++;
        return t;
      }
      function newTemp() {
        tempCounter++;
        return `t${tempCounter}`;
      }

      // Expr → Term ((+|-) Term)*
      function parseExpr() {
        let left = parseTerm();
        while (peek().type === "+" || peek().type === "-") {
          const op = consume(peek().type).type;
          const right = parseTerm();
          const t = newTemp();
          tac.push(`${t} = ${left} ${op} ${right}`);
          left = t;
        }
        return left;
      }

      // Term → Factor ((*|/) Factor)*
      function parseTerm() {
        let left = parseFactor();
        while (peek().type === "*" || peek().type === "/") {
          const op = consume(peek().type).type;
          const right = parseFactor();
          const t = newTemp();
          tac.push(`${t} = ${left} ${op} ${right}`);
          left = t;
        }
        return left;
      }

      // Factor → id | num | ( Expr )
      function parseFactor() {
        const t = peek();
        if (t.type === "id") {
          consume("id");
          // Use variable name directly; symbol table tracks last temp/value
          return t.value;
        } else if (t.type === "num") {
          consume("num");
          const temp = newTemp();
          tac.push(`${temp} = ${t.value}`);
          return temp;
        } else if (t.type === "(") {
          consume("(");
          const inner = parseExpr();
          consume(")");
          return inner;
        } else {
          throw new Error(`Unexpected token '${t.type}' in Factor at #${pos}`);
        }
      }

      // Stmt → id = Expr ;
      function parseStmt() {
        const idTok = consume("id");
        consume("=");
        const rhs = parseExpr();
        consume(";");
        tac.push(`${idTok.value} = ${rhs}`);

        // Update symbol table
        const entry = symtab.get(idTok.value) || { lastTemp: null, lastValue: null };
        entry.lastTemp = rhs.startsWith("t") ? rhs : null;
        entry.lastValue = rhs;
        symtab.set(idTok.value, entry);
      }

      // Program → Stmt*
      while (peek().type !== "EOF") {
        parseStmt();
      }

      return { tac, symtab };
    }

    // --- UI wiring ---
    const sourceEl = document.getElementById("source");
    const tacEl = document.getElementById("tac");
    const symtabEl = document.getElementById("symtab");
    const errorEl = document.getElementById("error");
    const compileBtn = document.getElementById("compileBtn");
    const resetBtn = document.getElementById("resetBtn");

    compileBtn.addEventListener("click", () => {
      errorEl.textContent = "";
      tacEl.textContent = "";
      symtabEl.textContent = "";
      try {
        const { tac, symtab } = compile(sourceEl.value);
        tacEl.textContent = tac.join("\n");

        const rows = [];
        for (const [name, info] of symtab.entries()) {
          rows.push(`${name}:\n  lastTemp: ${info.lastTemp ?? "null"}\n  lastValue: ${info.lastValue}`);
        }
        symtabEl.textContent = rows.join("\n\n");
      } catch (e) {
        errorEl.textContent = String(e.message);
      }
    });

    resetBtn.addEventListener("click", () => {
      sourceEl.value = "a = 5;\nb = a + 3;\nc = (b * 2) + a;";
      tacEl.textContent = "";
      symtabEl.textContent = "";
      errorEl.textContent = "";
    });
  </script>
</body>
</html>
